let restaurant,map;const reviewQueued=document.querySelector("#review-queued"),form=document.querySelector("#add-review"),getParameterByName=(e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},setInputValue=(e,t)=>{document.getElementsByName(e).value=t},fetchRestaurantFromURL=e=>{if(restaurant)return void e(null,restaurant);const t=getParameterByName("id");t?(DBHelper.fetchRestaurantById(t,(n,r)=>{(restaurant=r)?(fillRestaurantHTML(),e(null,restaurant),DBHelper.fetchQueuedReview(t,(e,t)=>{t&&(reviewQueued.classList.add("active"),form.classList.add("disabled"))})):console.error(n)}),DBHelper.fetchRestaurantReviews(t,(e,t)=>{e||fillReviewsHTML(t)})):e("No restaurant id in URL",null)},fillRestaurantHoursHTML=(e=restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const r=document.createElement("tr"),a=document.createElement("td"),i=document.createElement("td");a.innerHTML=n,i.innerHTML=e[n],r.appendChild(a),r.appendChild(i),t.appendChild(r)}},createReviewHTML=e=>{const t=document.createElement("article"),n=()=>document.createElement("span"),r=document.createElement("p"),a=document.createElement("strong"),i=document.createElement("p"),s=n(),d=n();return t.className="item",s.className="rating",r.className="info",a.innerHTML=e.name,d.innerHTML=` (${new Date(e.createdAt).toLocaleDateString()}) `,s.innerHTML=`${e.rating} â˜…`,i.innerHTML=e.comments,r.appendChild(a),r.appendChild(d),r.appendChild(s),t.appendChild(r),t.appendChild(i),t},fillReviewsHTML=e=>{const t=document.getElementById("reviews"),n=document.createElement("h4");if(n.innerHTML="Reviews",t.appendChild(n),!e){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}e.forEach(e=>t.appendChild(createReviewHTML(e)))},fillRestaurantHTML=(e=restaurant)=>{document.querySelector("#restaurantId").value=e.id,document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;const t=document.getElementById("restaurant-img");t.className="restaurant-img",t.src=DBHelper.imageUrlForRestaurant(e),t.alt=`Photo of '${e.name}' restaurant`,document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML()},fillBreadcrumbs=(e=restaurant)=>{const t=document.getElementById("breadcrumbs"),n=()=>document.createElement("span"),r=n(),a=n();r.innerHTML=e.name,a.className="separator",t.appendChild(a),t.appendChild(r)};window.initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumbs(),DBHelper.mapMarkerForRestaurant(t,map))})});const offlineInfo=document.querySelector("#offline-info"),submitReview=(e,t)=>{e?(reviewQueued.classList.add("active"),form.classList.add("disabled")):(document.querySelector("#reviews").appendChild(createReviewHTML(t)),reviewQueued.classList.remove("active"),form.classList.remove("disabled")),form.reset()};window.addEventListener("offline",()=>offlineInfo.classList.add("active"),!1),window.addEventListener("online",()=>{offlineInfo.classList.remove("active"),DBHelper.submitQueuedReview(restaurant.id,submitReview)},!1),form.addEventListener("submit",e=>{e.preventDefault();const t=new FormData(form),n={};for(let[e,r]of t.entries())n[e]=r;DBHelper.submitReview(n,submitReview)});